{% load staticfiles %}
{% load crispy_forms_tags %}
<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="utf-8" />
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Intouch - {% block title %}{% endblock %}</title>
	{% block head_base_links %}
		<link rel="stylesheet" href="{% static "css/foundation.css" %}" />
		<link rel="stylesheet" href="{% static "css/foundation-icons/foundation-icons.css" %}" />
		<link href="{% static "css/main.css" %}" rel="stylesheet">
		
		
		<script type="text/javascript" src="{% static 'js/jquery.js' %}"></script>
		<script type="text/javascript" src="{% static 'django_ajax/js/jquery.ajax.min.js' %}"></script>
		<script type="text/javascript" src="{% static 'django_ajax/js/jquery.ajax-plugin.min.js' %}"></script>
	{% endblock %}
</head>
<body class="{% block body_css_blk %}{{body_class}}{% endblock %}">
	{% block body %}
		{% block header%}{% endblock %}
		<div class="row">
			{% block container %}
			
			{% endblock %}
		</div>
		<div class="row">
			{% block footer %}{% endblock %}
		</div>

	{% endblock %}
	{% block foot_base_js %}
		<script type="text/javascript" src="{% static "js/vendor/what-input.js" %}"></script>
		<script type="text/javascript" src="{% static "js/vendor/foundation.js" %}"></script>
		<script type="text/javascript" src="{% static "js/main.js" %}"></script>
	{% endblock %}
	<div id="bug-report">
		<div class="row column show-for-medium">
			This Service is still in <a href="https://en.wikipedia.org/wiki/Software_release_life_cycle#BETA">Beta</a>.
			Help make it better by reporting issues or improvements.
			<a href="#" class="button success isfb-link" style="margin-top: 5px; margin-left: 1rem;">Report</a>		
		</div>
		<div class="show-for-small">
			<a href="#" class="button success isfb-link" style="margin-top: 5px; margin-left: 2rem;">Report Issue/Feedback</a>
		</div>
	</div>
	<div class="reveal tiny" id="bug-report-modal" data-reveal>
	  <h3>Issue/Feedback</h3>
	  {% crispy issueform %}
	  <button class="close-button" data-close aria-label="Close modal" type="button">
	    <span aria-hidden="true">&times;</span>
	  </button>
	</div>
	<div class="reveal tiny" id="bug-report-thankyou" data-reveal>
	  <h2 class="text-center">Thank You!</h2>
	  <h3 class="text-center"><small>Feedback Received</small></h3>
	  <button class="close-button" data-close aria-label="Close modal" type="button">
	    <span aria-hidden="true">&times;</span>
	  </button>
	</div>
	
	<script>
		$(document).ready(function(){
			$("a.isfb-link").click(function(e){
				var brm = new Foundation.Reveal($("#bug-report-modal"));
				brm.open();
			})
			
			$.ajaxSetup({
				crossDomain : false,
				processData: false,
				contentType: false,
				cache: false
			});
			
			$("#issue-submit-form").submit(function(e){
				
				
				e.preventDefault();
				
				var payload = new FormData(this);	
				ajaxPost('/settings/system/feedback/', payload, function(content){
					
					if (content.hasOwnProperty("errors")){
	           			var errors = $.parseJSON(content.errors);	
	           		
	           			$.each(errors, function(index, value){
	           				if (index === '__all__'){
	           					$('div.nonfield-ajax-error').remove();
	           					$("small.error").remove();
	           					$("#sms-transfer-form").prepend('<div class="alert callout nonfield-ajax-error">'+value[0].message+'</div>');
	           				}else{
	           					$("small.error").remove();
	           					//select field with error and apply text after it
	           					$("[name="+index+"]").after('<small class="error">'+value[0].message+'</small>');
	           				}
	           			});
	           			
	           		}else{
	           			$('div.nonfield-ajax-error').remove();
	           			$("small.error").remove();
	           			
	           			console.log(content.result);
	           			
	           			//document.getElementById("issue-submit-form").reset();
	           			$("#issue-submit-form")[0].reset();
	           			var brtu = new Foundation.Reveal($("#bug-report-thankyou"));
	           			$("#bug-report-modal").foundation('close');
	    				setTimeout(brtu.open(),1000);
	    				
	           		}
				})
				
			})
		});
		
		
		
	</script>
</body>
</html>